# Port 161, 162 - SNMP

## Table of Contents
- [Enumeration](#enumeration)
  - [snmpwalk](#snmpwalk)
  - [snmp-check](#snmp-check)
  - [Nmap Scripts](#nmap-scripts)
  - [Common OIDs](#common-oids)
- [Community String Discovery](#community-string-discovery)
- [Windows Enumeration](#windows-enumeration)
- [Attack Vectors](#attack-vectors)

---

## Enumeration

### snmpwalk

```shell
# SNMPv1/v2c (most common)
snmpwalk -c public -v1 $rhost
snmpwalk -c public -v2c $rhost

# Walk specific OID
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.1.1.0

# Walk entire MIB tree
snmpwalk -c public -v2c $rhost .1
```

### snmp-check

```shell
# Comprehensive enumeration
snmp-check -t $rhost -c public

# Without community string (tries default 'public')
snmp-check -t $rhost
```

### snmpget

```shell
# Retrieve specific OID
snmpget -v2c -c public $rhost sysDescr.0
snmpget -v2c -c public $rhost .1.3.6.1.2.1.1.1.0
```

### Nmap Scripts

```shell
# SNMP info
nmap -sU -p 161 --script snmp-info $rhost

# System description
nmap -sU -p 161 --script snmp-sysdescr $rhost -sV

# Network interfaces
nmap -sU -p 161 --script snmp-interfaces $rhost -sV

# Listening ports
nmap -sU -p 161 --script snmp-netstat $rhost -sV

# Running processes
nmap -sU -p 161 --script snmp-processes $rhost -sV

# Brute force community strings
nmap -sU -p 161 --script snmp-brute --script-args snmp-brute.communitiesdb=community_strings.txt $rhost
```

### Common OIDs

| OID | Description |
|-----|-------------|
| .1.3.6.1.2.1.1.1.0 | System Description |
| .1.3.6.1.2.1.1.5.0 | System Name |
| .1.3.6.1.4.1.77.1.2.25 | Windows Users |
| .1.3.6.1.2.1.25.4.2.1.2 | Running Processes |
| .1.3.6.1.2.1.25.6.3.1.2 | Installed Software |
| .1.3.6.1.2.1.6.13.1.3 | TCP Ports |
| .1.3.6.1.2.1.4.22.1.3 | ARP Table |

---

## Community String Discovery

### onesixtyone

```shell
onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt $rhost
```

### Metasploit

```shell
use auxiliary/scanner/snmp/snmp_login
set RHOSTS $rhost
set PASS_FILE /path/to/community_wordlist.txt
run
```

---

## Windows Enumeration

```shell
# Windows users
snmpwalk -c public -v2c $rhost .1.3.6.1.4.1.77.1.2.25

# Running processes
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.25.4.2.1.2

# Installed software
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.25.6.3.1.2

# Using Metasploit
use auxiliary/scanner/snmp/snmp_enum
set RHOSTS $rhost
set COMMUNITY public
run

# Enumerate users
use auxiliary/scanner/snmp/snmp_enumusers
set RHOSTS $rhost
run

# Enumerate shares
use auxiliary/scanner/snmp/snmp_enumshares
set RHOSTS $rhost
run
```

---

## Attack Vectors

### Default Community Strings

```shell
snmpwalk -c public -v2c $rhost
snmpwalk -c private -v2c $rhost
snmpwalk -c admin -v2c $rhost
snmpwalk -c manager -v2c $rhost
snmpwalk -c community -v2c $rhost
```

### Write Access Exploitation

> If 'private' community string has write access

```shell
# Change system name
snmpset -v2c -c private $rhost .1.3.6.1.2.1.1.5.0 s "NewSystemName"
```

### Information Disclosure

```shell
# ARP cache (network mapping)
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.4.22.1.3

# Routing tables
snmpwalk -c public -v2c $rhost .1.3.6.1.2.1.4.21.1.1

# IP addresses
snmpwalk -c public -v2c $rhost ipAddrTable

# Usernames (Windows)
snmpwalk -c public -v2c $rhost .1.3.6.1.4.1.77.1.2.25
```
